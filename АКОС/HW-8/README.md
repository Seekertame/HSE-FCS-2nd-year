# Домашнее задание 8

Клиент и сервер взаимодействуют через POSIX-разделяемую память (`shm_open` + `mmap`).

## Запуск

Сборка доступна двумя способами:

- **Через CMake (рекомендуется для единообразия):**

  ```bash
  cmake -S . -B build
  cmake --build build
  ```

  Готовые бинарники появятся в каталоге `build/`.

- **Непосредственно компилятором C:**

  ```bash
  gcc -std=c11 -Wall -Wextra client.c -o client
  gcc -std=c11 -Wall -Wextra server.c -o server
  ```

Запускать процессы нужно в отдельных терминалах:

```bash
./server
./client
```

## Протокол обмена

- Разделяемая память называется `"/hw8_shm"` и содержит структуру `shared_data` с PID процессов, последним отправленным значением и флагами `has_value`/`terminate_flag`.
- Клиент раз в 0.5 секунды генерирует случайное число в диапазоне `0..99`, записывает его в память и выставляет флаг `has_value`.
- Сервер с периодом 0.1 секунды проверяет наличие данных: если `has_value == 1`, выводит число и сбрасывает флаг.

## Корректное завершение

Для корректного завершения используется симметричная обработка сигналов `SIGINT`/`SIGTERM`:

1. Каждый процесс устанавливает свой PID в разделяемой памяти.
2. При получении сигнала или обнаружении `terminate_flag` в памяти процесс вызывает общее завершение: выставляет `terminate_flag = 1` и отправляет `SIGTERM` второму процессу (PID берётся из разделяемой памяти).
3. Оба процесса завершают цикл, корректно снимают свои PID и размыкают отображение памяти. Каждый дополнительно вызывает `shm_unlink`, поэтому сегмент гарантированно удаляется, как только оба закрывают дескрипторы.

Такое поведение обеспечивает взаимное завершение при попытке остановить любую из сторон и освобождение ресурса разделяемой памяти после выхода обоих процессов.
